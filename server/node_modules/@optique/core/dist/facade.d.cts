import { Message } from "./message.cjs";
import { ShowDefaultOptions } from "./doc.cjs";
import { InferMode, InferValue, Mode, ModeValue, Parser } from "./parser.cjs";
import { ShellCompletion } from "./completion.cjs";

//#region src/facade.d.ts

/**
 * Configuration options for the {@link run} function.
 *
 * @template THelp The return type when help is shown.
 * @template TError The return type when an error occurs.
 */
interface RunOptions<THelp, TError> {
  /**
   * Enable colored output in help and error messages.
   *
   * @default `false`
   */
  readonly colors?: boolean;
  /**
   * Maximum width for output formatting. Text will be wrapped to fit within
   * this width.  If not specified, text will not be wrapped.
   */
  readonly maxWidth?: number;
  /**
   * Whether and how to display default values for options and arguments.
   *
   * - `boolean`: When `true`, displays defaults using format `[value]`
   * - `ShowDefaultOptions`: Custom formatting with configurable prefix and suffix
   *
   * Default values are automatically dimmed when `colors` is enabled.
   *
   * @default `false`
   * @since 0.4.0
   */
  readonly showDefault?: boolean | ShowDefaultOptions;
  /**
   * Help configuration. When provided, enables help functionality.
   */
  readonly help?: {
    /**
     * Determines how help is made available:
     *
     * - `"command"`: Only the `help` subcommand is available
     * - `"option"`: Only the `--help` option is available
     * - `"both"`: Both `help` subcommand and `--help` option are available
     *
     * @default `"option"`
     */
    readonly mode?: "command" | "option" | "both";
    /**
     * Callback function invoked when help is requested. The function can
     * optionally receive an exit code parameter.
     *
     * You usually want to pass `process.exit` on Node.js or Bun and `Deno.exit`
     * on Deno to this option.
     *
     * @default Returns `void` when help is shown.
     */
    readonly onShow?: (() => THelp) | ((exitCode: number) => THelp);
  };
  /**
   * Version configuration. When provided, enables version functionality.
   */
  readonly version?: {
    /**
     * Determines how version is made available:
     *
     * - `"command"`: Only the `version` subcommand is available
     * - `"option"`: Only the `--version` option is available
     * - `"both"`: Both `version` subcommand and `--version` option are available
     *
     * @default `"option"`
     */
    readonly mode?: "command" | "option" | "both";
    /**
     * The version string to display when version is requested.
     */
    readonly value: string;
    /**
     * Callback function invoked when version is requested. The function can
     * optionally receive an exit code parameter.
     *
     * You usually want to pass `process.exit` on Node.js or Bun and `Deno.exit`
     * on Deno to this option.
     *
     * @default Returns `void` when version is shown.
     */
    readonly onShow?: (() => THelp) | ((exitCode: number) => THelp);
  };
  /**
   * Completion configuration. When provided, enables shell completion functionality.
   * @since 0.6.0
   */
  readonly completion?: {
    /**
     * Determines how completion is made available:
     *
     * - `"command"`: Only the `completion` subcommand is available
     * - `"option"`: Only the `--completion` option is available
     * - `"both"`: Both `completion` subcommand and `--completion` option are available
     *
     * @default `"both"`
     */
    readonly mode?: "command" | "option" | "both";
    /**
     * Determines whether to use singular or plural naming for completion command/option.
     *
     * - `"singular"`: Use `completion` / `--completion`
     * - `"plural"`: Use `completions` / `--completions`
     * - `"both"`: Use both singular and plural forms
     *
     * @default `"both"`
     */
    readonly name?: "singular" | "plural" | "both";
    /**
     * Available shell completions. By default, includes `bash`, `fish`, `nu`,
     * `pwsh`, and `zsh`. You can provide additional custom shell completions or
     * override the defaults.
     *
     * @default `{ bash, fish, nu, pwsh, zsh }`
     */
    readonly shells?: Record<string, ShellCompletion>;
    /**
     * Callback function invoked when completion is requested. The function can
     * optionally receive an exit code parameter.
     *
     * You usually want to pass `process.exit` on Node.js or Bun and `Deno.exit`
     * on Deno to this option.
     *
     * @default Returns `void` when completion is shown.
     */
    readonly onShow?: (() => THelp) | ((exitCode: number) => THelp);
  };
  /**
   * What to display above error messages:
   * - `"usage"`: Show usage information
   * - `"help"`: Show help text (if available)
   * - `"none"`: Show nothing above errors
   *
   * @default `"usage"`
   */
  readonly aboveError?: "usage" | "help" | "none";
  /**
   * Callback function invoked when parsing fails. The function can
   * optionally receive an exit code parameter.
   *
   * You usually want to pass `process.exit` on Node.js or Bun and `Deno.exit`
   * on Deno to this option.
   * @default Throws a {@link RunError}.
   */
  readonly onError?: (() => TError) | ((exitCode: number) => TError);
  /**
   * Function used to output error messages.  Assumes it prints the ending
   * newline.
   *
   * @default `console.error`
   */
  readonly stderr?: (text: string) => void;
  /**
   * Function used to output help and usage messages.  Assumes it prints
   * the ending newline.
   *
   * @default `console.log`
   */
  readonly stdout?: (text: string) => void;
  /**
   * Brief description shown at the top of help text.
   *
   * @since 0.4.0
   */
  readonly brief?: Message;
  /**
   * Detailed description shown after the usage line.
   *
   * @since 0.4.0
   */
  readonly description?: Message;
  /**
   * Footer text shown at the bottom of help text.
   *
   * @since 0.4.0
   */
  readonly footer?: Message;
}
/**
 * Runs a parser against command-line arguments with built-in help and error
 * handling.
 *
 * This function provides a complete CLI interface by automatically handling
 * help commands/options and displaying formatted error messages with usage
 * information when parsing fails. It augments the provided parser with help
 * functionality based on the configuration options.
 *
 * The function will:
 *
 * 1. Add help command/option support (unless disabled)
 * 2. Parse the provided arguments
 * 3. Display help if requested
 * 4. Show formatted error messages with usage/help info on parse failures
 * 5. Return the parsed result or invoke the appropriate callback
 *
 * @template TParser The parser type being run.
 * @template THelp Return type when help is shown (defaults to `void`).
 * @template TError Return type when an error occurs (defaults to `never`).
 * @param parser The parser to run against the command-line arguments.
 * @param programName Name of the program used in usage and help output.
 * @param args Command-line arguments to parse (typically from
 *             `process.argv.slice(2)` on Node.js or `Deno.args` on Deno).
 * @param options Configuration options for output formatting and callbacks.
 * @returns The parsed result value, or the return value of `onHelp`/`onError`
 *          callbacks.
 * @throws {RunParserError} When parsing fails and no `onError` callback is
 *          provided.
 */
declare function runParser<TParser extends Parser<"sync", unknown, unknown>, THelp = void, TError = never>(parser: TParser, programName: string, args: readonly string[], options?: RunOptions<THelp, TError>): InferValue<TParser>;
declare function runParser<TParser extends Parser<"async", unknown, unknown>, THelp = void, TError = never>(parser: TParser, programName: string, args: readonly string[], options?: RunOptions<THelp, TError>): Promise<InferValue<TParser>>;
declare function runParser<TParser extends Parser<Mode, unknown, unknown>, THelp = void, TError = never>(parser: TParser, programName: string, args: readonly string[], options?: RunOptions<THelp, TError>): ModeValue<InferMode<TParser>, InferValue<TParser>>;
/**
 * Runs a synchronous command-line parser with the given options.
 *
 * This is a type-safe version of {@link runParser} that only accepts sync
 * parsers. Use this when you know your parser is sync-only to get direct
 * return values without Promise wrappers.
 *
 * @template TParser The sync parser type being executed.
 * @template THelp The return type of the onHelp callback.
 * @template TError The return type of the onError callback.
 * @param parser The synchronous command-line parser to execute.
 * @param programName The name of the program for help messages.
 * @param args The command-line arguments to parse.
 * @param options Configuration options for customizing behavior.
 * @returns The parsed result if successful.
 * @since 0.9.0
 */
declare function runParserSync<TParser extends Parser<"sync", unknown, unknown>, THelp = void, TError = never>(parser: TParser, programName: string, args: readonly string[], options?: RunOptions<THelp, TError>): InferValue<TParser>;
/**
 * Runs any command-line parser asynchronously with the given options.
 *
 * This function accepts parsers of any mode (sync or async) and always
 * returns a Promise. Use this when working with parsers that may contain
 * async value parsers.
 *
 * @template TParser The parser type being executed.
 * @template THelp The return type of the onHelp callback.
 * @template TError The return type of the onError callback.
 * @param parser The command-line parser to execute.
 * @param programName The name of the program for help messages.
 * @param args The command-line arguments to parse.
 * @param options Configuration options for customizing behavior.
 * @returns A Promise of the parsed result if successful.
 * @since 0.9.0
 */
declare function runParserAsync<TParser extends Parser<Mode, unknown, unknown>, THelp = void, TError = never>(parser: TParser, programName: string, args: readonly string[], options?: RunOptions<THelp, TError>): Promise<InferValue<TParser>>;
/**
 * @deprecated Use `runParser()` instead. This export will be removed in
 *             a future major version. The name `run` conflicts with
 *             `@optique/run`'s `run()` function, causing IDE autocomplete
 *             confusion.
 */
declare const run: typeof runParser;
/**
 * An error class used to indicate that the command line arguments
 * could not be parsed successfully.
 */
declare class RunParserError extends Error {
  constructor(message: string);
}
/**
 * @deprecated Use `RunParserError` instead. This export will be removed in
 *             a future major version.
 */
declare const RunError: typeof RunParserError;
//#endregion
export { RunError, RunOptions, RunParserError, run, runParser, runParserAsync, runParserSync };