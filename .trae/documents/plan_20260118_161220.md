# Drawer组件实现计划

## 1. 组件概述

设计一个符合shadcn风格的Drawer组件，具有以下特点：
- 支持push和overlay两种显示效果
- 支持左右position
- 使用Preact Signals管理状态
- 支持键盘导航和外部点击关闭
- 遵循shadcn组件的设计模式

## 2. 组件结构

### 核心组件
- **Drawer**：主容器组件，管理Drawer的显示状态
- **Drawer.Content**：Drawer的内容区域
- **Drawer.Header**：Drawer的头部，包含标题
- **Drawer.Body**：Drawer的主体内容
- **Drawer.Footer**：Drawer的底部，包含操作按钮

### 支持的Props
- **open**：控制Drawer显示/隐藏的Signal<boolean>
- **position**：Drawer的位置，可选值：'left' | 'right'（默认：'right'）
- **effect**：Drawer的显示效果，可选值：'overlay' | 'push'（默认：'overlay'）
- **onOpenChange**：Drawer状态变化时的回调函数
- **size**：Drawer的宽度，可选值：'sm' | 'md' | 'lg' | 'xl' | 'full'（默认：'md'）

## 3. 实现细节

### 1. 组件文件结构
```
libs/shadcn/components/
├── Drawer.tsx       # 主组件实现
└── utils/
    └── cn.tsx       # 类名合并工具
```

### 2. 核心功能实现

#### 状态管理
- 使用Preact Signals管理Drawer的显示状态
- 支持外部控制和内部关闭

#### 显示效果
- **overlay**：Drawer覆盖在主内容上方，背景半透明
- **push**：Drawer滑入时，主内容被推挤

#### 位置控制
- **left**：Drawer从左侧滑入
- **right**：Drawer从右侧滑入

#### 尺寸控制
- 提供多种预设尺寸：sm（320px）、md（480px）、lg（640px）、xl（800px）、full（100%）

#### 交互功能
- 支持ESC键关闭
- 支持点击背景关闭
- 支持点击关闭按钮关闭
- 支持拖动边缘调整大小（可选）

### 3. 样式实现
- 使用tailwind CSS类
- 遵循shadcn的设计风格
- 支持深色/浅色主题
- 平滑的过渡动画

### 4. 代码实现

#### 组件定义
```tsx
import { cn } from "../utils/cn.tsx";
import { type ComponentChild, createContext, type JSX } from "preact";
import { useContext, useEffect, useRef } from "preact/hooks";
import { type Signal } from "@preact/signals";

// Drawer Context
export type DrawerContextType = {
  open: Signal<boolean>;
  position: DrawerProps["position"];
};

export const DrawerContext = createContext<DrawerContextType>({
  open: { value: false } as Signal<boolean>,
  position: "right",
});

// Drawer Props
export type DrawerProps = {
  open: Signal<boolean>;
  position?: "left" | "right";
  effect?: "overlay" | "push";
  size?: "sm" | "md" | "lg" | "xl" | "full";
  onOpenChange?: (open: boolean) => void;
  children: ComponentChild;
} & JSX.IntrinsicElements["div"];

// Drawer Component
export function Drawer({...}) {
  // 实现Drawer逻辑
}

// Drawer Content Component
function DrawerContent({...}) {
  // 实现Content逻辑
}

// Drawer Header Component
function DrawerHeader({...}) {
  // 实现Header逻辑
}

// Drawer Body Component
function DrawerBody({...}) {
  // 实现Body逻辑
}

// Drawer Footer Component
function DrawerFooter({...}) {
  // 实现Footer逻辑
}

// 组件组合
Drawer.Content = DrawerContent;
Drawer.Header = DrawerHeader;
Drawer.Body = DrawerBody;
Drawer.Footer = DrawerFooter;
```

### 5. 样式定义

#### 尺寸映射
```
const sizeMap = {
  sm: "w-80",
  md: "w-96",
  lg: "w-[640px]",
  xl: "w-[800px]",
  full: "w-full",
};
```

#### 位置样式
```
const positionMap = {
  left: "left-0 right-auto",
  right: "right-0 left-auto",
};
```

#### 效果样式
```
// overlay效果
const overlayStyles = "fixed inset-y-0 z-50 transition-transform duration-300";

// push效果
const pushStyles = "fixed inset-y-0 z-50 transition-transform duration-300";
const pushContentStyles = "transition-transform duration-300";
```

### 6. 使用示例

```tsx
import { useSignal } from "@preact/signals";
import { Drawer, Button } from "@24wings/shadcn";

function App() {
  const isOpen = useSignal(false);

  return (
    <div>
      <Button onClick={() => (isOpen.value = true)}>
        打开Drawer
      </Button>

      <Drawer open={isOpen} position="right" effect="push">
        <Drawer.Content>
          <Drawer.Header title="Drawer标题" />
          <Drawer.Body>
            <p>Drawer内容</p>
          </Drawer.Body>
          <Drawer.Footer>
            <Button variant="outline" onClick={() => (isOpen.value = false)}>
              关闭
            </Button>
            <Button onClick={() => (isOpen.value = false)}>
              确认
            </Button>
          </Drawer.Footer>
        </Drawer.Content>
      </Drawer>
    </div>
  );
}
```

## 4. 实现步骤

1. 创建Drawer.tsx文件
2. 实现Drawer核心组件
3. 实现Drawer.Content、Header、Body、Footer子组件
4. 实现overlay和push效果
5. 实现左右position支持
6. 添加键盘导航和外部点击关闭功能
7. 测试组件的各种配置和效果
8. 编写组件文档

## 5. 测试计划

- 测试Drawer的显示/隐藏功能
- 测试左右position效果
- 测试overlay和push效果
- 测试不同尺寸的Drawer
- 测试键盘导航和外部点击关闭
- 测试响应式表现

## 6. 技术规范

- 遵循shadcn组件的设计风格
- 使用Preact Signals管理状态
- 支持深色/浅色主题
- 代码符合TypeScript规范
- 组件具有良好的可访问性
- 支持响应式设计

## 7. 预期效果

- Drawer组件能够按照预期显示和隐藏
- 支持左右position和overlay/push效果
- 具有平滑的过渡动画
- 支持键盘导航和外部点击关闭
- 符合shadcn组件的设计风格
- 能够与其他shadcn组件良好配合使用